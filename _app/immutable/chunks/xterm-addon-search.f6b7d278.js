import{g as E}from"./_commonjsHelpers.725317a4.js";function W(C,z){for(var R=0;R<z.length;R++){const p=z[R];if(typeof p!="string"&&!Array.isArray(p)){for(const w in p)if(w!=="default"&&!(w in C)){const D=Object.getOwnPropertyDescriptor(p,w);D&&Object.defineProperty(C,w,D.get?D:{enumerable:!0,get:()=>p[w]})}}}return Object.freeze(Object.defineProperty(C,Symbol.toStringTag,{value:"Module"}))}var y={},k={get exports(){return y},set exports(C){y=C}};(function(C,z){(function(R,p){C.exports=p()})(self,function(){return(()=>{var R={345:(b,d)=>{Object.defineProperty(d,"__esModule",{value:!0}),d.forwardEvent=d.EventEmitter=void 0,d.EventEmitter=class{constructor(){this._listeners=[],this._disposed=!1}get event(){return this._event||(this._event=u=>(this._listeners.push(u),{dispose:()=>{if(!this._disposed){for(let a=0;a<this._listeners.length;a++)if(this._listeners[a]===u)return void this._listeners.splice(a,1)}}})),this._event}fire(u,a){const g=[];for(let x=0;x<this._listeners.length;x++)g.push(this._listeners[x]);for(let x=0;x<g.length;x++)g[x].call(void 0,u,a)}dispose(){this._listeners&&(this._listeners.length=0),this._disposed=!0}},d.forwardEvent=function(u,a){return u(g=>a.fire(g))}},859:(b,d)=>{function u(a){for(const g of a)g.dispose();a.length=0}Object.defineProperty(d,"__esModule",{value:!0}),d.getDisposeArrayDisposable=d.disposeArray=d.toDisposable=d.Disposable=void 0,d.Disposable=class{constructor(){this._disposables=[],this._isDisposed=!1}dispose(){this._isDisposed=!0;for(const a of this._disposables)a.dispose();this._disposables.length=0}register(a){return this._disposables.push(a),a}unregister(a){const g=this._disposables.indexOf(a);g!==-1&&this._disposables.splice(g,1)}},d.toDisposable=function(a){return{dispose:a}},d.disposeArray=u,d.getDisposeArrayDisposable=function(a){return{dispose:()=>u(a)}}}},p={};function w(b){var d=p[b];if(d!==void 0)return d.exports;var u=p[b]={exports:{}};return R[b](u,u.exports,w),u.exports}var D={};return(()=>{var b=D;Object.defineProperty(b,"__esModule",{value:!0}),b.SearchAddon=void 0;const d=w(345),u=w(859),a=" ~!@#$%^&*()+`-=[]{}|\\;:\"',./<>?";class g extends u.Disposable{constructor(){super(...arguments),this._linesCacheTimeoutId=0,this._onDidChangeResults=this.register(new d.EventEmitter),this.onDidChangeResults=this._onDidChangeResults.event}activate(e){this._terminal=e,this._onDataDisposable=this.register(this._terminal.onWriteParsed(()=>this._updateMatches())),this._onResizeDisposable=this.register(this._terminal.onResize(()=>this._updateMatches())),this.register((0,u.toDisposable)(()=>{var t,r;this.clearDecorations(),(t=this._onDataDisposable)===null||t===void 0||t.dispose(),(r=this._onResizeDisposable)===null||r===void 0||r.dispose()}))}_updateMatches(){var e;this._highlightTimeout&&window.clearTimeout(this._highlightTimeout),this._cachedSearchTerm&&(!((e=this._lastSearchOptions)===null||e===void 0)&&e.decorations)&&(this._highlightTimeout=setTimeout(()=>{var t,r;this.findPrevious(this._cachedSearchTerm,Object.assign(Object.assign({},this._lastSearchOptions),{incremental:!0,noScroll:!0})),this._resultIndex=this._searchResults?this._searchResults.size-1:-1,this._onDidChangeResults.fire({resultIndex:this._resultIndex,resultCount:(r=(t=this._searchResults)===null||t===void 0?void 0:t.size)!==null&&r!==void 0?r:-1})},200))}clearDecorations(e){var t,r,s,o;(t=this._selectedDecoration)===null||t===void 0||t.dispose(),(r=this._searchResults)===null||r===void 0||r.clear(),(s=this._resultDecorations)===null||s===void 0||s.forEach(i=>{for(const n of i)n.dispose()}),(o=this._resultDecorations)===null||o===void 0||o.clear(),this._searchResults=void 0,this._resultDecorations=void 0,e||(this._cachedSearchTerm=void 0)}clearActiveDecoration(){var e;(e=this._selectedDecoration)===null||e===void 0||e.dispose(),this._selectedDecoration=void 0}findNext(e,t){if(!this._terminal)throw new Error("Cannot use addon until it has been loaded");return this._lastSearchOptions=t,t!=null&&t.decorations&&(this._resultIndex===void 0&&this._cachedSearchTerm!==void 0&&e===this._cachedSearchTerm||this._highlightAllMatches(e,t)),this._fireResults(e,this._findNextAndSelect(e,t),t)}_highlightAllMatches(e,t){if(!this._terminal)throw new Error("Cannot use addon until it has been loaded");if(!e||e.length===0)return void this.clearDecorations();t=t||{},this.clearDecorations(!0),this._searchResults=new Map,this._resultDecorations=new Map;const r=this._resultDecorations;let s=this._find(e,0,0,t);for(;s&&!this._searchResults.get(`${s.row}-${s.col}`);)if(this._searchResults.set(`${s.row}-${s.col}`,s),s=this._find(e,s.col+s.term.length>=this._terminal.cols?s.row+1:s.row,s.col+s.term.length>=this._terminal.cols?0:s.col+1,t),this._searchResults.size>1e3)return this.clearDecorations(),void(this._resultIndex=void 0);this._searchResults.forEach(o=>{const i=this._createResultDecoration(o,t.decorations);if(i){const n=r.get(i.marker.line)||[];n.push(i),r.set(i.marker.line,n)}})}_find(e,t,r,s){var o;if(!this._terminal||!e||e.length===0)return(o=this._terminal)===null||o===void 0||o.clearSelection(),void this.clearDecorations();if(r>this._terminal.cols)throw new Error(`Invalid col: ${r} to search in terminal of ${this._terminal.cols} cols`);let i;this._initLinesCache();const n={startRow:t,startCol:r};if(i=this._findInLine(e,n,s),!i)for(let l=t+1;l<this._terminal.buffer.active.baseY+this._terminal.rows&&(n.startRow=l,n.startCol=0,i=this._findInLine(e,n,s),!i);l++);return i}_findNextAndSelect(e,t){var r;if(!this._terminal||!e||e.length===0)return(r=this._terminal)===null||r===void 0||r.clearSelection(),this.clearDecorations(),this._cachedSearchTerm=void 0,this._resultIndex=-1,!1;this._cachedSearchTerm!==e&&(this._resultIndex=void 0,this._terminal.clearSelection());let s,o=0,i=0;if(this._terminal.hasSelection()){const h=!!t&&t.incremental;s=this._terminal.getSelectionPosition(),i=h?s.start.y:s.end.y,o=h?s.start.x:s.end.x}this._initLinesCache();const n={startRow:i,startCol:o};let l=this._findInLine(e,n,t);if(!l)for(let h=i+1;h<this._terminal.buffer.active.baseY+this._terminal.rows&&(n.startRow=h,n.startCol=0,l=this._findInLine(e,n,t),!l);h++);if(!l&&i!==0)for(let h=0;h<i&&(n.startRow=h,n.startCol=0,l=this._findInLine(e,n,t),!l);h++);return!l&&s&&(n.startRow=s.start.y,n.startCol=0,l=this._findInLine(e,n,t)),this._searchResults&&(this._searchResults.size===0?this._resultIndex=-1:this._resultIndex===void 0?this._resultIndex=0:(this._resultIndex++,this._resultIndex>=this._searchResults.size&&(this._resultIndex=0))),this._selectResult(l,t==null?void 0:t.decorations,t==null?void 0:t.noScroll)}findPrevious(e,t){if(!this._terminal)throw new Error("Cannot use addon until it has been loaded");return this._lastSearchOptions=t,t!=null&&t.decorations&&(this._resultIndex===void 0&&this._cachedSearchTerm!==void 0&&e===this._cachedSearchTerm||this._highlightAllMatches(e,t)),this._fireResults(e,this._findPreviousAndSelect(e,t),t)}_fireResults(e,t,r){var s;return r!=null&&r.decorations&&(this._resultIndex!==void 0&&((s=this._searchResults)===null||s===void 0?void 0:s.size)!==void 0?this._onDidChangeResults.fire({resultIndex:this._resultIndex,resultCount:this._searchResults.size}):this._onDidChangeResults.fire(void 0)),this._cachedSearchTerm=e,t}_findPreviousAndSelect(e,t){var r;if(!this._terminal)throw new Error("Cannot use addon until it has been loaded");let s;if(!this._terminal||!e||e.length===0)return s=void 0,(r=this._terminal)===null||r===void 0||r.clearSelection(),this.clearDecorations(),this._resultIndex=-1,!1;this._cachedSearchTerm!==e&&(this._resultIndex=void 0,this._terminal.clearSelection());let o=this._terminal.buffer.active.baseY+this._terminal.rows,i=this._terminal.cols;const n=!0,l=!!t&&t.incremental;let h;this._terminal.hasSelection()&&(h=this._terminal.getSelectionPosition(),o=h.start.y,i=h.start.x),this._initLinesCache();const c={startRow:o,startCol:i};if(l?(s=this._findInLine(e,c,t,!1),s&&s.row===o&&s.col===i||(h&&(c.startRow=h.end.y,c.startCol=h.end.x),s=this._findInLine(e,c,t,!0))):s=this._findInLine(e,c,t,n),!s){c.startCol=Math.max(c.startCol,this._terminal.cols);for(let f=o-1;f>=0&&(c.startRow=f,s=this._findInLine(e,c,t,n),!s);f--);}if(!s&&o!==this._terminal.buffer.active.baseY+this._terminal.rows)for(let f=this._terminal.buffer.active.baseY+this._terminal.rows;f>=o&&(c.startRow=f,s=this._findInLine(e,c,t,n),!s);f--);return this._searchResults&&(this._searchResults.size===0?this._resultIndex=-1:this._resultIndex===void 0||this._resultIndex<0?this._resultIndex=this._searchResults.size-1:(this._resultIndex--,this._resultIndex===-1&&(this._resultIndex=this._searchResults.size-1))),!(s||!h)||this._selectResult(s,t==null?void 0:t.decorations,t==null?void 0:t.noScroll)}_initLinesCache(){const e=this._terminal;this._linesCache||(this._linesCache=new Array(e.buffer.active.length),this._cursorMoveListener=e.onCursorMove(()=>this._destroyLinesCache()),this._resizeListener=e.onResize(()=>this._destroyLinesCache())),window.clearTimeout(this._linesCacheTimeoutId),this._linesCacheTimeoutId=window.setTimeout(()=>this._destroyLinesCache(),15e3)}_destroyLinesCache(){this._linesCache=void 0,this._cursorMoveListener&&(this._cursorMoveListener.dispose(),this._cursorMoveListener=void 0),this._resizeListener&&(this._resizeListener.dispose(),this._resizeListener=void 0),this._linesCacheTimeoutId&&(window.clearTimeout(this._linesCacheTimeoutId),this._linesCacheTimeoutId=0)}_isWholeWord(e,t,r){return(e===0||a.includes(t[e-1]))&&(e+r.length===t.length||a.includes(t[e+r.length]))}_findInLine(e,t,r={},s=!1){var o;const i=this._terminal,n=t.startRow,l=t.startCol,h=i.buffer.active.getLine(n);if(h!=null&&h.isWrapped)return s?void(t.startCol+=i.cols):(t.startRow--,t.startCol+=i.cols,this._findInLine(e,t,r));let c=(o=this._linesCache)===null||o===void 0?void 0:o[n];c||(c=this._translateBufferLineToStringWithWrap(n,!0),this._linesCache&&(this._linesCache[n]=c));const[f,S]=c,I=this._bufferColsToStringOffset(n,l),L=r.caseSensitive?e:e.toLowerCase(),T=r.caseSensitive?f:f.toLowerCase();let m=-1;if(r.regex){const v=RegExp(L,"g");let _;if(s)for(;_=v.exec(T.slice(0,I));)m=v.lastIndex-_[0].length,e=_[0],v.lastIndex-=e.length-1;else _=v.exec(T.slice(I)),_&&_[0].length>0&&(m=I+(v.lastIndex-_[0].length),e=_[0])}else s?I-L.length>=0&&(m=T.lastIndexOf(L,I-L.length)):m=T.indexOf(L,I);if(m>=0){if(r.wholeWord&&!this._isWholeWord(m,T,e))return;let v=0;for(;v<S.length-1&&m>=S[v+1];)v++;let _=v;for(;_<S.length-1&&m+e.length>=S[_+1];)_++;const O=m-S[v],A=m+e.length-S[_],M=this._stringLengthToBufferSize(n+v,O);return{term:e,col:M,row:n+v,size:this._stringLengthToBufferSize(n+_,A)-M+i.cols*(_-v)}}}_stringLengthToBufferSize(e,t){const r=this._terminal.buffer.active.getLine(e);if(!r)return 0;for(let s=0;s<t;s++){const o=r.getCell(s);if(!o)break;const i=o.getChars();i.length>1&&(t-=i.length-1);const n=r.getCell(s+1);n&&n.getWidth()===0&&t++}return t}_bufferColsToStringOffset(e,t){const r=this._terminal;let s=e,o=0,i=r.buffer.active.getLine(s);for(;t>0&&i;){for(let n=0;n<t&&n<r.cols;n++){const l=i.getCell(n);if(!l)break;l.getWidth()&&(o+=l.getCode()===0?1:l.getChars().length)}if(s++,i=r.buffer.active.getLine(s),i&&!i.isWrapped)break;t-=r.cols}return o}_translateBufferLineToStringWithWrap(e,t){var r;const s=this._terminal,o=[],i=[0];let n=s.buffer.active.getLine(e);for(;n;){const l=s.buffer.active.getLine(e+1),h=!!l&&l.isWrapped;let c=n.translateToString(!h&&t);if(h&&l){const f=n.getCell(n.length-1);f&&f.getCode()===0&&f.getWidth()===1&&((r=l.getCell(0))===null||r===void 0?void 0:r.getWidth())===2&&(c=c.slice(0,-1))}if(o.push(c),!h)break;i.push(i[i.length-1]+c.length),e++,n=l}return[o.join(""),i]}_selectResult(e,t,r){var s,o;const i=this._terminal;if(this.clearActiveDecoration(),!e)return i.clearSelection(),!1;if(i.select(e.col,e.row,e.size),t){const n=i.registerMarker(-i.buffer.active.baseY-i.buffer.active.cursorY+e.row);n&&(this._selectedDecoration=i.registerDecoration({marker:n,x:e.col,width:e.size,backgroundColor:t.activeMatchBackground,layer:"top",overviewRulerOptions:{color:t.activeMatchColorOverviewRuler}}),(s=this._selectedDecoration)===null||s===void 0||s.onRender(l=>this._applyStyles(l,t.activeMatchBorder,!0)),(o=this._selectedDecoration)===null||o===void 0||o.onDispose(()=>n.dispose()))}if(!r&&(e.row>=i.buffer.active.viewportY+i.rows||e.row<i.buffer.active.viewportY)){let n=e.row-i.buffer.active.viewportY;n-=Math.floor(i.rows/2),i.scrollLines(n)}return!0}_applyStyles(e,t,r){e.clientWidth<=0||(e.classList.contains("xterm-find-result-decoration")||(e.classList.add("xterm-find-result-decoration"),t&&(e.style.outline=`1px solid ${t}`)),r&&e.classList.add("xterm-find-active-result-decoration"))}_createResultDecoration(e,t){var r;const s=this._terminal,o=s.registerMarker(-s.buffer.active.baseY-s.buffer.active.cursorY+e.row);if(!o)return;const i=s.registerDecoration({marker:o,x:e.col,width:e.size,backgroundColor:t.matchBackground,overviewRulerOptions:!((r=this._resultDecorations)===null||r===void 0)&&r.get(o.line)?void 0:{color:t.matchOverviewRuler,position:"center"}});return i==null||i.onRender(n=>this._applyStyles(n,t.matchBorder,!1)),i==null||i.onDispose(()=>o.dispose()),i}}b.SearchAddon=g})(),D})()})})(k);const P=E(y),j=W({__proto__:null,default:P},[y]);export{j as x};
